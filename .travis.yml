sudo: required

# not necessary, but less confusing if defined
language: python

services:
  - docker

env:
  - DISTRO=debian:stable PYTHON="2"
  - DISTRO=debian:stable PYTHON="3" # 3.4, not 3.5
  - DISTRO=debian:stable PYTHON="3" KRB5_VER="heimdal"
  - DISTRO=centos:7 PYTHON="2" # el7 doesn't do python3 modules
  - DISTRO=fedora:rawhide PYTHON="3"
  - DISTRO=fedora:rawhide PYTHON="2"

script:
  - sudo sed -i '1i 127.0.0.1 test.box' /etc/hosts
  - sudo hostname test.box
  - >
    docker run
    -v `pwd`:/tmp/build
    -w /tmp/build
    -e KRB5_VER=$KRB5_VER
    -e PYTHON=$PYTHON
    $DISTRO
    /bin/bash -ex .travis.sh

before_deploy:
  - >
    docker run
    -v `pwd`:/tmp/build
    -w /tmp/build
    -e TRAVIS_TAG=$TRAVIS_TAG
    -e PKG_NAME_VER=$PKG_NAME_VER
    -e KRB5_VER=$KRB5_VER
    -e PYTHON=$PYTHON
    $DISTRO
    /bin/bash -ex .travis.before-deploy.sh
deploy:
  - provider: releases
    api_key:
      secure: e8kjZEY28gWySD5FsnG9CMgeKgFS12gB/xm1Ck1jEgIhYT01VwxvBMHIU7SV/92+aeBao5clN4/qN4P035hD8TShHUMzV7rsmXmqcaCwi3J5sh2hyy4e1PfYAshuX7bxvkfqJSvSonLz0AKHW4pj17yMrTXpWiEioGg0fSLtTHo=
    file_glob: true
    file:
      - tag_build/*
    on:
      repo: pythongssapi/python-gssapi
      tags: true
      condition: "$DISTRO = 'fedora:rawhide' && $PYTHON = '3'"
    skip_cleanup: true
  - provider: pypi
    user:
      secure: "c00ALag2DKlSDbpuldoyYenA1+8J+T3tyQ1dTozEBqr57uvVqH8ACaeN3BM0QWVssYpQRgM28CVDrELLA2OS/cdAzdC4GH6E7uMwlYMop3eJD0LMyl4hMaejOAeDfe9HOJy2QqyXPM1OCdGYJ9N1G14TDuZCu14r1udEkscEG2I="
    password:
      secure: "GTuDbZAVsV9oIBG3dnmLuh/UdXUDyEvu6J7Nl92xpf9Fh9OznZwE0mgBGqUfi27lAdFq52NMbX4CtiQSiExUBi+CztGI3xuVPSvGewZ4ChAD3eu7028dtSzuLckJztjnBiWVRZq06J1ibFmzWsOKYhFZc5PCmisudLa4Zm2htAg="
    on:
      repo: pythongssapi/python-gssapi
      tags: true
      condition: "$DISTRO = 'fedora:rawhide' && $PYTHON = '3'"
    skip_cleanup: true
    docs_dir: travis_docs_build/html
